<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <!-- common.css -->
  <style>* {-webkit-tap-highlight-color: rgba(0,0,0,0);}html {-webkit-text-size-adjust: none;}body {font-family: Arial, Helvetica, sans-serif;margin: 0;color: #333;word-wrap: break-word;}h1, h2, h3, h4, h5, h6 {line-height: 1.1;}img {max-width: 100% !important;}blockquote {margin: 0;padding: 0 15px;color: #777;border-left: 4px solid #ddd;}hr {background-color: #ddd;border: 0;height: 1px;margin: 15px 0;}code {font-family: Menlo, Consolas, 'Ubuntu Mono', Monaco, 'source-code-pro', monospace;line-height: 1.4;margin: 0;padding: 0.2em 0;font-size: 85%;background-color: rgba(0,0,0,0.04);border-radius: 3px;}pre {margin: 0;}pre > code {margin: 0;padding: 0;font-size: 100%;word-break: normal;background: transparent;border: 0;}ol {list-style-type: decimal;}ol ol, ul ol {list-style-type: lower-latin;}ol ol ol, ul ol ol, ul ul ol, ol ul ol {list-style-type: lower-roman;}table {border-spacing: 0;border-collapse: collapse;margin-top: 0;margin-bottom: 16px;}table th {font-weight: bold;}table th, table td {padding: 6px 13px;border: 1px solid #ddd;}table tr {border-top: 1px solid #ccc;}table tr:nth-child(even) {background-color: #f8f8f8;}input[type="checkbox"] {cursor: default;margin-right: 0.5em;font-size: 13px;}.task-list-item {list-style-type: none;}.task-list-item+.task-list-item {margin-top: 3px;}.task-list-item input {float: left;margin: 0.3em 1em 0.25em -1.6em;vertical-align: middle;}#tag-field {margin: 8px 2px 10px;}#tag-field .tag {display: inline-block;background: #cadff3;border-radius: 4px;padding: 1px 8px;color: black;font-size: 12px;margin-right: 10px;line-height: 1.4;}</style>
  <!-- ace-static.css -->
  <style>.ace_static_highlight {white-space: pre-wrap;}.ace_static_highlight .ace_gutter {width: 2em;text-align: right;padding: 0 3px 0 0;margin-right: 3px;}.ace_static_highlight.ace_show_gutter .ace_line {padding-left: 2.6em;}.ace_static_highlight .ace_line {position: relative;}.ace_static_highlight .ace_gutter-cell {-moz-user-select: -moz-none;-khtml-user-select: none;-webkit-user-select: none;user-select: none;top: 0;bottom: 0;left: 0;position: absolute;}.ace_static_highlight .ace_gutter-cell:before {content: counter(ace_line, decimal);counter-increment: ace_line;}.ace_static_highlight {counter-reset: ace_line;}</style>
  <style>.ace-tomorrow-night-eighties .ace_gutter {background: #272727;color: #CCC}.ace-tomorrow-night-eighties .ace_print-margin {width: 1px;background: #272727}.ace-tomorrow-night-eighties {background-color: #2D2D2D;color: #CCCCCC}.ace-tomorrow-night-eighties .ace_constant.ace_other,.ace-tomorrow-night-eighties .ace_cursor {color: #CCCCCC}.ace-tomorrow-night-eighties .ace_marker-layer .ace_selection {background: #515151}.ace-tomorrow-night-eighties.ace_multiselect .ace_selection.ace_start {box-shadow: 0 0 3px 0px #2D2D2D;border-radius: 2px}.ace-tomorrow-night-eighties .ace_marker-layer .ace_step {background: rgb(102, 82, 0)}.ace-tomorrow-night-eighties .ace_marker-layer .ace_bracket {margin: -1px 0 0 -1px;border: 1px solid #6A6A6A}.ace-tomorrow-night-bright .ace_stack {background: rgb(66, 90, 44)}.ace-tomorrow-night-eighties .ace_marker-layer .ace_active-line {background: #393939}.ace-tomorrow-night-eighties .ace_gutter-active-line {background-color: #393939}.ace-tomorrow-night-eighties .ace_marker-layer .ace_selected-word {border: 1px solid #515151}.ace-tomorrow-night-eighties .ace_invisible {color: #6A6A6A}.ace-tomorrow-night-eighties .ace_keyword,.ace-tomorrow-night-eighties .ace_meta,.ace-tomorrow-night-eighties .ace_storage,.ace-tomorrow-night-eighties .ace_storage.ace_type,.ace-tomorrow-night-eighties .ace_support.ace_type {color: #CC99CC}.ace-tomorrow-night-eighties .ace_keyword.ace_operator {color: #66CCCC}.ace-tomorrow-night-eighties .ace_constant.ace_character,.ace-tomorrow-night-eighties .ace_constant.ace_language,.ace-tomorrow-night-eighties .ace_constant.ace_numeric,.ace-tomorrow-night-eighties .ace_keyword.ace_other.ace_unit,.ace-tomorrow-night-eighties .ace_support.ace_constant,.ace-tomorrow-night-eighties .ace_variable.ace_parameter {color: #F99157}.ace-tomorrow-night-eighties .ace_invalid {color: #CDCDCD;background-color: #F2777A}.ace-tomorrow-night-eighties .ace_invalid.ace_deprecated {color: #CDCDCD;background-color: #CC99CC}.ace-tomorrow-night-eighties .ace_fold {background-color: #6699CC;border-color: #CCCCCC}.ace-tomorrow-night-eighties .ace_entity.ace_name.ace_function,.ace-tomorrow-night-eighties .ace_support.ace_function,.ace-tomorrow-night-eighties .ace_variable {color: #6699CC}.ace-tomorrow-night-eighties .ace_support.ace_class,.ace-tomorrow-night-eighties .ace_support.ace_type {color: #FFCC66}.ace-tomorrow-night-eighties .ace_heading,.ace-tomorrow-night-eighties .ace_markup.ace_heading,.ace-tomorrow-night-eighties .ace_string {color: #99CC99}.ace-tomorrow-night-eighties .ace_comment {color: #999999}.ace-tomorrow-night-eighties .ace_entity.ace_name.ace_tag,.ace-tomorrow-night-eighties .ace_entity.ace_other.ace_attribute-name,.ace-tomorrow-night-eighties .ace_meta.ace_tag,.ace-tomorrow-night-eighties .ace_variable {color: #F2777A}.ace-tomorrow-night-eighties .ace_indent-guide {background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAAEklEQVQImWPQ09NrYAgMjP4PAAtGAwchHMyAAAAAAElFTkSuQmCC) right repeat-y}</style>
  <!-- export.css -->
  <style>
    body{margin:0 auto;max-width:800px;line-height:1.4}
    #nav{margin:5px 0 10px;font-size:15px}
    #titlearea{border-bottom:1px solid #ccc;font-size:17px;padding:10px 0;}
    #contentarea{font-size:15px;margin:16px 0}
    .cell{outline:0;min-height:20px;margin:5px 0;padding:5px 0;}
    .code-cell{font-family:Menlo,Consolas,'Ubuntu Mono',Monaco,'source-code-pro',monospace;font-size:12px;}
    .latex-cell{white-space:pre-wrap;}
  </style>
  <!-- User CSS -->
  <style> .text-cell {font-size: 15px;}.code-cell {font-size: 12px;}.markdown-cell {font-size: 15px;}.latex-cell {font-size: 15px;}</style>
</head>
<body>
  
  <div id="titlearea">
    <h2>Retrofit的使用</h2>
  </div>
  <div id="contentarea"><div class="cell markdown-cell"><p>最近将Android项目的网络连接库切换到了Retrofit 2.0,以前用的Volley。<br>使用Retrofit后接口更加接近RESTful风格。逻辑更加清晰，更加灵活。</p>
<h2 id="-">基本使用：</h2>
<p>定义接口:<br>  新建一个Service接口类，在该类中声明要调用的接口。<br>  例如：</p>
<pre><code class="lang-java"><div class="ace-tomorrow-night-eighties"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_keyword">public</span>&nbsp;<span class="ace_keyword">interface</span>&nbsp;<span class="ace_identifier">GitHubService</span>&nbsp;{
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;&nbsp;@<span class="ace_identifier">GET</span>(<span class="ace_string">"users/{user}/repos"</span>)
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;&nbsp;<span class="ace_identifier">Call</span><span class="ace_keyword ace_operator">&lt;</span><span class="ace_identifier">List</span><span class="ace_keyword ace_operator">&lt;</span><span class="ace_identifier">Repo</span><span class="ace_keyword ace_operator">&gt;&gt;</span>&nbsp;<span class="ace_identifier">listRepos</span>(@<span class="ace_identifier">Path</span>(<span class="ace_string">"user"</span>)&nbsp;<span class="ace_support ace_function">String</span>&nbsp;<span class="ace_identifier">user</span>);
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>&nbsp;&nbsp;&nbsp;&nbsp;}
</div></div></div>
</code></pre>
<p>   @GET 表示该接口是用HTTP GET调用，GET后面的括号里面是该接口的Endpoint（主机后面的地址）。<br>   @Path 是用来动态替换URL中的字段的{}的部分，用来动态生成URL.</p>
<p>   POST方式：</p>
<pre><code class="lang-java"><div class="ace-tomorrow-night-eighties"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>&nbsp;&nbsp;&nbsp;@<span class="ace_identifier">POST</span>(<span class="ace_string">"users/new"</span>)
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>&nbsp;&nbsp;&nbsp;<span class="ace_identifier">Call</span><span class="ace_keyword ace_operator">&lt;</span><span class="ace_identifier">User</span><span class="ace_keyword ace_operator">&gt;</span>&nbsp;<span class="ace_identifier">createUser</span>(@<span class="ace_identifier">Body</span>&nbsp;<span class="ace_identifier">User</span>&nbsp;<span class="ace_identifier">user</span>);
</div></div></div>
</code></pre>
<p>   @Body 请求的body，Retrofit会自动用配置的格式转换器将User对象转化为对用的格式（如JSON，XML等）</p>
<pre><code class="lang-java"><div class="ace-tomorrow-night-eighties"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>&nbsp;&nbsp;&nbsp;@<span class="ace_identifier">FormUrlEncoded</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>&nbsp;&nbsp;&nbsp;@<span class="ace_identifier">POST</span>(<span class="ace_string">"user/edit"</span>)
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>&nbsp;&nbsp;&nbsp;<span class="ace_identifier">Call</span><span class="ace_keyword ace_operator">&lt;</span><span class="ace_identifier">User</span><span class="ace_keyword ace_operator">&gt;</span>&nbsp;<span class="ace_identifier">updateUser</span>(@<span class="ace_identifier">Field</span>(<span class="ace_string">"first_name"</span>)&nbsp;<span class="ace_support ace_function">String</span>&nbsp;<span class="ace_identifier">first</span>,&nbsp;@<span class="ace_identifier">Field</span>(<span class="ace_string">"last_name"</span>)&nbsp;<span class="ace_support ace_function">String</span>&nbsp;<span class="ace_identifier">last</span>);
</div></div></div>
</code></pre>
<p>   post提交form形式，@FormUrlEncoded 表示该请求的body是Form-encoded数据。@Field就是form的字段名称。</p>
<p>  Map:</p>
<pre><code class="lang-java"><div class="ace-tomorrow-night-eighties"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>&nbsp;&nbsp;&nbsp;@<span class="ace_identifier">ormUrlEncoded</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>&nbsp;&nbsp;&nbsp;@<span class="ace_identifier">POST</span>(<span class="ace_string">"/some/endpoint"</span>)
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>&nbsp;&nbsp;&nbsp;<span class="ace_identifier">Call</span><span class="ace_keyword ace_operator">&lt;</span><span class="ace_identifier">SomeResponse</span><span class="ace_keyword ace_operator">&gt;</span>&nbsp;<span class="ace_identifier">someEndpoint</span>(@<span class="ace_identifier">FieldMap</span>&nbsp;<span class="ace_identifier">Map</span><span class="ace_keyword ace_operator">&lt;</span><span class="ace_support ace_function">String</span>,&nbsp;<span class="ace_support ace_function">String</span><span class="ace_keyword ace_operator">&gt;</span>&nbsp;<span class="ace_identifier">names</span>);
</div></div></div>
</code></pre>
<p>   多参数表单数据：</p>
<pre><code class="lang-java"><div class="ace-tomorrow-night-eighties"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>&nbsp;&nbsp;&nbsp;@<span class="ace_identifier">Multipart</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>&nbsp;&nbsp;&nbsp;@<span class="ace_identifier">PUT</span>(<span class="ace_string">"user/photo"</span>)
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>&nbsp;&nbsp;&nbsp;<span class="ace_identifier">Call</span><span class="ace_keyword ace_operator">&lt;</span><span class="ace_identifier">User</span><span class="ace_keyword ace_operator">&gt;</span>&nbsp;<span class="ace_identifier">updateUser</span>(@<span class="ace_identifier">Part</span>(<span class="ace_string">"photo"</span>)&nbsp;<span class="ace_identifier">RequestBody</span>&nbsp;<span class="ace_identifier">photo</span>,&nbsp;@<span class="ace_identifier">Part</span>(<span class="ace_string">"description"</span>)&nbsp;&nbsp;&nbsp;<span class="ace_identifier">RequestBody</span>&nbsp;<span class="ace_identifier">description</span>);
</div></div></div>
</code></pre>
<p>   设置请求Header:</p>
<pre><code class="lang-java"><div class="ace-tomorrow-night-eighties"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>&nbsp;&nbsp;&nbsp;@<span class="ace_identifier">Headers</span>({
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_string">"Accept:&nbsp;application/vnd.github.v3.full+json"</span>,
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_string">"User-Agent:&nbsp;Retrofit-Sample-App"</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>&nbsp;&nbsp;&nbsp;})
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>&nbsp;&nbsp;&nbsp;@<span class="ace_identifier">GET</span>(<span class="ace_string">"users/{username}"</span>)
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>&nbsp;&nbsp;&nbsp;<span class="ace_identifier">Call</span><span class="ace_keyword ace_operator">&lt;</span><span class="ace_identifier">User</span><span class="ace_keyword ace_operator">&gt;</span>&nbsp;<span class="ace_identifier">getUser</span>(@<span class="ace_identifier">Path</span>(<span class="ace_string">"username"</span>)&nbsp;<span class="ace_support ace_function">String</span>&nbsp;<span class="ace_identifier">username</span>);
</div></div></div>
</code></pre>
<h3 id="-">接口调用：</h3>
<pre><code class="lang-java"><div class="ace-tomorrow-night-eighties"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>&nbsp;&nbsp;&nbsp;<span class="ace_identifier">Retrofit</span>&nbsp;<span class="ace_identifier">retrofit</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_keyword">new</span>&nbsp;<span class="ace_identifier">Retrofit</span>.<span class="ace_identifier">Builder</span>()
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>&nbsp;&nbsp;&nbsp;&nbsp;.<span class="ace_identifier">baseUrl</span>(<span class="ace_string">"https://api.github.com"</span>)
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>&nbsp;&nbsp;&nbsp;&nbsp;.<span class="ace_identifier">addConverterFactory</span>(<span class="ace_identifier">GsonConverterFactory</span>.<span class="ace_identifier">create</span>())
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>&nbsp;&nbsp;&nbsp;&nbsp;.<span class="ace_identifier">build</span>();
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>&nbsp;&nbsp;&nbsp;<span class="ace_identifier">GitHubService</span>&nbsp;<span class="ace_identifier">service</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">retrofit</span>.<span class="ace_identifier">create</span>(<span class="ace_identifier">GitHubService</span>.<span class="ace_keyword">class</span>);
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>&nbsp;&nbsp;&nbsp;<span class="ace_identifier">Call</span><span class="ace_keyword ace_operator">&lt;</span><span class="ace_identifier">List</span><span class="ace_keyword ace_operator">&lt;</span><span class="ace_identifier">Repo</span><span class="ace_keyword ace_operator">&gt;&gt;</span>&nbsp;<span class="ace_identifier">call</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">service</span>.<span class="ace_identifier">listRepos</span>(<span class="ace_string">"user"</span>);
</div></div></div>
</code></pre>
<p>   创建一个Retrofit对象，创建的时候要指定BaseUrl和数据格式转换器。数据格式转换器用来将请求的对象转换为对用的数据格式。例如配置GsonConverterFactory，则会将请求中的对象转换为JSON字符串，将响应中的JSON字符串转换为对象。<br>   Retrofit支持的转换器：</p>
<blockquote>
<p><strong>Gson</strong>: com.squareup.retrofit2:converter-gson<br><strong>Jackson</strong>: com.squareup.retrofit2:converter-jackson<br><strong>Moshi</strong>: com.squareup.retrofit2:converter-moshi<br><strong>Protobuf</strong>: com.squareup.retrofit2:converter-protobuf<br><strong>Wire</strong>: com.squareup.retrofit2:converter-wire<br><strong>Simple XML</strong>: com.squareup.retrofit2:converter-simplexml<br><strong>Scalars (primitives, boxed, and String)</strong>: com.squareup.retrofit2:converter-scalars</p>
</blockquote>
<p>   你也可以自定义一个转换器，例如：</p>
<pre><code class="lang-java"><div class="ace-tomorrow-night-eighties"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>&nbsp;&nbsp;&nbsp;<span class="ace_keyword">private</span>&nbsp;<span class="ace_keyword">static</span>&nbsp;<span class="ace_keyword">class</span>&nbsp;<span class="ace_identifier">RawJsonConverterFactory</span>&nbsp;<span class="ace_keyword">extends</span>&nbsp;<span class="ace_identifier">Converter</span>.<span class="ace_identifier">Factory</span>&nbsp;{
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_keyword">public</span>&nbsp;<span class="ace_keyword">static</span>&nbsp;<span class="ace_identifier">RawJsonConverterFactory</span>&nbsp;<span class="ace_identifier">create</span>()&nbsp;{
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_keyword">return</span>&nbsp;<span class="ace_keyword">new</span>&nbsp;<span class="ace_identifier">RawJsonConverterFactory</span>();
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;&nbsp;&nbsp;}
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;&nbsp;&nbsp;@<span class="ace_support ace_function">Override</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_keyword">public</span>&nbsp;<span class="ace_identifier">Converter</span><span class="ace_keyword ace_operator">&lt;</span>?,&nbsp;<span class="ace_identifier">RequestBody</span><span class="ace_keyword ace_operator">&gt;</span>&nbsp;<span class="ace_identifier">toRequestBody</span>(<span class="ace_identifier">Type</span>&nbsp;<span class="ace_identifier">type</span>,&nbsp;<span class="ace_identifier">Annotation</span>[]&nbsp;<span class="ace_identifier">annotations</span>)&nbsp;{
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_keyword">return</span>&nbsp;<span class="ace_keyword">super</span>.<span class="ace_identifier">toRequestBody</span>(<span class="ace_identifier">type</span>,&nbsp;<span class="ace_identifier">annotations</span>);
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;&nbsp;&nbsp;}
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;&nbsp;&nbsp;@<span class="ace_support ace_function">Override</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_keyword">public</span>&nbsp;<span class="ace_identifier">Converter</span><span class="ace_keyword ace_operator">&lt;</span><span class="ace_identifier">ResponseBody</span>,&nbsp;?<span class="ace_keyword ace_operator">&gt;</span>&nbsp;<span class="ace_identifier">fromResponseBody</span>(<span class="ace_identifier">Type</span>&nbsp;<span class="ace_identifier">type</span>,&nbsp;<span class="ace_identifier">Annotation</span>[]&nbsp;<span class="ace_identifier">annotations</span>)&nbsp;{
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_keyword">return</span>&nbsp;<span class="ace_keyword">new</span>&nbsp;<span class="ace_identifier">RawJsonResponseBodyConverter</span>();
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;&nbsp;&nbsp;}
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>&nbsp;&nbsp;&nbsp;&nbsp;}
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_keyword">private</span>&nbsp;<span class="ace_keyword">static</span>&nbsp;<span class="ace_keyword">class</span>&nbsp;<span class="ace_identifier">RawJsonResponseBodyConverter</span><span class="ace_keyword ace_operator">&lt;</span><span class="ace_support ace_function">String</span><span class="ace_keyword ace_operator">&gt;</span>&nbsp;<span class="ace_keyword">implements</span>&nbsp;<span class="ace_identifier">Converter</span><span class="ace_keyword ace_operator">&lt;</span><span class="ace_identifier">ResponseBody</span>,&nbsp;<span class="ace_support ace_function">String</span><span class="ace_keyword ace_operator">&gt;</span>&nbsp;{
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_keyword">public</span>&nbsp;<span class="ace_identifier">RawJsonResponseBodyConverter</span>()&nbsp;{
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;&nbsp;&nbsp;}
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;&nbsp;&nbsp;@<span class="ace_support ace_function">Override</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_keyword">public</span>&nbsp;<span class="ace_support ace_function">String</span>&nbsp;<span class="ace_identifier">convert</span>(<span class="ace_identifier">ResponseBody</span>&nbsp;<span class="ace_identifier">value</span>)&nbsp;<span class="ace_keyword">throws</span>&nbsp;<span class="ace_identifier">IOException</span>&nbsp;{
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_keyword">return</span>&nbsp;(<span class="ace_support ace_function">String</span>)&nbsp;<span class="ace_identifier">value</span>.<span class="ace_identifier">string</span>();
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;&nbsp;&nbsp;}
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>&nbsp;&nbsp;&nbsp;&nbsp;}
</div></div></div>
</code></pre>
<p>  接口调用后返回一个Call&lt;?&gt;对象,call的泛型就是接口数据转换后的对象。Call可以指定该次请求同步还是异步。<br>  同步：</p>
<pre><code class="lang-java"><div class="ace-tomorrow-night-eighties"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>&nbsp;&nbsp;<span class="ace_identifier">Response</span><span class="ace_keyword ace_operator">&lt;</span><span class="ace_identifier">List</span><span class="ace_keyword ace_operator">&lt;</span><span class="ace_identifier">Repo</span><span class="ace_keyword ace_operator">&gt;&gt;</span>&nbsp;<span class="ace_identifier">response</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">call</span>.<span class="ace_identifier">execute</span>();
</div></div></div>
</code></pre>
<p>  同步调用接口直接返回一个Response对象，Response包含响应的所有数据：响应码（the reponse code），响应消息（the response message），以及读取相应头（headers）和body；Body就是接口返回的最终数据。</p>
<p>  异步：</p>
<pre><code class="lang-java"><div class="ace-tomorrow-night-eighties"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>&nbsp;&nbsp;<span class="ace_identifier">call</span>.<span class="ace_identifier">enqueue</span>(<span class="ace_keyword">new</span>&nbsp;<span class="ace_identifier">Callback</span><span class="ace_keyword ace_operator">&lt;</span><span class="ace_identifier">List</span><span class="ace_keyword ace_operator">&lt;</span><span class="ace_identifier">Repo</span><span class="ace_keyword ace_operator">&gt;&gt;</span>()&nbsp;{
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;@<span class="ace_support ace_function">Override</span>&nbsp;<span class="ace_keyword">void</span>&nbsp;<span class="ace_identifier">onResponse</span>(<span class="ace_comment">/*&nbsp;...&nbsp;*/</span>)&nbsp;{
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_comment">//&nbsp;...</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;}
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;@<span class="ace_support ace_function">Override</span>&nbsp;<span class="ace_keyword">void</span>&nbsp;<span class="ace_identifier">onFailure</span>(<span class="ace_support ace_function">Throwable</span>&nbsp;<span class="ace_identifier">t</span>)&nbsp;{
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_comment">//&nbsp;...</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;}
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>&nbsp;&nbsp;});
</div></div></div>
</code></pre>
<p>  异步要传一个接口回调接口，接口包含请求成功和失败的方法回调。</p>
<hr>
<h2 id="-log-timeout">关于打印Log和设置Timeout</h2>
<p>  由于请求和响应在Retrofit中直接转换处理了，Retrofit中又没暴漏出来可以打印URL和请求Body的方法，所以打印Log就没那么直接了。解决方案：<br>  指定HTTPClent,在HTTPClient中使用拦截器打印Log.<br>  Retrofit默认使用的是OkHttp,当然你也可以使用别的Http Client.</p>
<pre><code class="lang-java"><div class="ace-tomorrow-night-eighties"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>&nbsp;&nbsp;<span class="ace_identifier">OkHttpClient</span>&nbsp;<span class="ace_identifier">client</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_keyword">new</span>&nbsp;<span class="ace_identifier">OkHttpClient</span>();
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>&nbsp;&nbsp;<span class="ace_identifier">client</span>.<span class="ace_identifier">setConnectTimeout</span>(<span class="ace_constant ace_numeric">30</span>,&nbsp;<span class="ace_identifier">TimeUnit</span>.<span class="ace_identifier">SECONDS</span>);&nbsp;&nbsp;<span class="ace_comment">//<span class="ace_cjk" style="width:20px">连</span><span class="ace_cjk" style="width:20px">接</span><span class="ace_cjk" style="width:20px">超</span><span class="ace_cjk" style="width:20px">时</span></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>&nbsp;&nbsp;<span class="ace_identifier">client</span>.<span class="ace_identifier">setReadTimeout</span>(<span class="ace_constant ace_numeric">30</span>,<span class="ace_identifier">TimeUnit</span>.<span class="ace_identifier">SECONDS</span>);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_comment">//<span class="ace_cjk" style="width:20px">读</span><span class="ace_cjk" style="width:20px">取</span><span class="ace_cjk" style="width:20px">数</span><span class="ace_cjk" style="width:20px">据</span><span class="ace_cjk" style="width:20px">超</span><span class="ace_cjk" style="width:20px">时</span></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>&nbsp;&nbsp;<span class="ace_identifier">client</span>.<span class="ace_identifier">setWriteTimeout</span>(<span class="ace_constant ace_numeric">10</span>,<span class="ace_identifier">TimeUnit</span>.<span class="ace_identifier">SECONDS</span>);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_comment">//<span class="ace_cjk" style="width:20px">发</span><span class="ace_cjk" style="width:20px">送</span><span class="ace_cjk" style="width:20px">数</span><span class="ace_cjk" style="width:20px">据</span><span class="ace_cjk" style="width:20px">超</span><span class="ace_cjk" style="width:20px">时</span></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>&nbsp;&nbsp;<span class="ace_comment">//Log<span class="ace_cjk" style="width:20px">拦</span><span class="ace_cjk" style="width:20px">截</span><span class="ace_cjk" style="width:20px">器</span><span class="ace_cjk" style="width:20px">，</span><span class="ace_cjk" style="width:20px">打</span><span class="ace_cjk" style="width:20px">印</span><span class="ace_cjk" style="width:20px">请</span><span class="ace_cjk" style="width:20px">求</span><span class="ace_cjk" style="width:20px">和</span><span class="ace_cjk" style="width:20px">响</span><span class="ace_cjk" style="width:20px">应</span><span class="ace_cjk" style="width:20px">的</span>LOG</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>&nbsp;&nbsp;<span class="ace_identifier">HttpLoggingInterceptor</span>&nbsp;<span class="ace_identifier">logging</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_keyword">new</span>&nbsp;<span class="ace_identifier">HttpLoggingInterceptor</span>();
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>&nbsp;&nbsp;<span class="ace_identifier">logging</span>.<span class="ace_identifier">setLevel</span>(<span class="ace_identifier">HttpLoggingInterceptor</span>.<span class="ace_identifier">Level</span>.<span class="ace_identifier">BASIC</span>);
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>&nbsp;&nbsp;<span class="ace_identifier">client</span>.<span class="ace_identifier">interceptors</span>().<span class="ace_identifier">add</span>(<span class="ace_identifier">logging</span>);
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>&nbsp;&nbsp;<span class="ace_identifier">Retrofit</span>&nbsp;<span class="ace_identifier">retrofit</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_keyword">new</span>&nbsp;<span class="ace_identifier">Retrofit</span>.<span class="ace_identifier">Builder</span>()
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>&nbsp;&nbsp;&nbsp;&nbsp;.<span class="ace_identifier">baseUrl</span>(<span class="ace_string">"https://api.github.com"</span>)
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>&nbsp;&nbsp;&nbsp;&nbsp;.<span class="ace_identifier">client</span>(<span class="ace_identifier">client</span>)&nbsp;&nbsp;<span class="ace_comment">//<span class="ace_cjk" style="width:20px">设</span><span class="ace_cjk" style="width:20px">置</span>Client</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>&nbsp;&nbsp;&nbsp;&nbsp;.<span class="ace_identifier">build</span>();
</div></div></div>
</code></pre>
<p>  Log的Level有4个级别：NONE，BASIC，HEADERS，BODY<br>  NONE：不打印Log<br>  BASIC: 只打印请求和响应的基本信息<br>  HEADERS：打印基本信息和头信息<br>  BODY：打印请求和响应的所有信息</p>
<hr>
<h2 id="-converter">多converter</h2>
<p>  Retrofit可以配置多个转换器，如可以同时设置JSON和XML的转换器，Retrofit会使用配置的所有的converter对数据进行转换。<br>  所以添加 converter 的顺序很重要，<br>  例如：</p>
<pre><code class="lang-java"><div class="ace-tomorrow-night-eighties"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>&nbsp;&nbsp;<span class="ace_identifier">Retrofit</span>&nbsp;<span class="ace_identifier">retrofit</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_keyword">new</span>&nbsp;<span class="ace_identifier">Retrofit</span>.<span class="ace_identifier">Builder</span>()
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>&nbsp;&nbsp;&nbsp;&nbsp;.<span class="ace_identifier">baseUrl</span>(<span class="ace_string">"https://api.github.com"</span>)
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>&nbsp;&nbsp;&nbsp;&nbsp;.<span class="ace_identifier">addConverterFactory</span>(<span class="ace_identifier">GsonConverterFactory</span>.<span class="ace_identifier">create</span>())
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>&nbsp;&nbsp;&nbsp;&nbsp;.<span class="ace_identifier">addConverterFactory</span>(<span class="ace_identifier">ProtoConverterFactory</span>.<span class="ace_identifier">create</span>())
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>&nbsp;&nbsp;&nbsp;&nbsp;.<span class="ace_identifier">build</span>();
</div></div></div>
</code></pre>
<p>  设置了一个Gson转换器和一个Proto转换器，按照配置的顺序，Retrofit会依次询问每个converter能否处理数据，只能数据被处理了或试过了所有的转换器。</p>
</div></div>
  <script></script>
</body>
</html>